"""
Phase 2: ç”¨ DeepSeek ç”Ÿæˆ Joker é£æ ¼çš„åˆæˆè®­ç»ƒæ•°æ®ã€‚

ç­–ç•¥ï¼š
1. ç»™ DeepSeek æ³¨å…¥ full_portrait.md + èŠå¤©æ ·æœ¬ä½œä¸ºå‚è€ƒ
2. æä¾›å¤šç§åœºæ™¯æ¨¡æ¿ï¼ˆæ—¥å¸¸èŠå¤©ã€æ·±åº¦è¯é¢˜ã€æƒ…æ„Ÿè¯é¢˜ç­‰ï¼‰
3. è®©æ¨¡å‹ç”Ÿæˆ Joker é£æ ¼çš„å¤šè½®å¯¹è¯
4. è¾“å‡º ShareGPT æ ¼å¼ï¼Œä¸çœŸå®æ•°æ®åˆå¹¶

ç”¨æ³•ï¼š
  python generate_joker.py                    # é»˜è®¤ç”Ÿæˆ 100 æ¡
  python generate_joker.py --count 200        # ç”Ÿæˆ 200 æ¡
  python generate_joker.py --style brother    # åªç”Ÿæˆ brother é£æ ¼
"""
import argparse
import json
import os
import random
import sys
import time
from typing import Dict, List

from bot_core import load_dotenv, call_deepseek
from joker_prompt_builder import build_joker_system_prompt


# â”€â”€ åœºæ™¯æ¨¡æ¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SCENARIOS = {
    "brother": [
        "å…„å¼Ÿæ¥æ‰¾ä½ åˆ†æä»–è¿½å¥³ç”Ÿçš„ç­–ç•¥ï¼Œä½ å¸®ä»–å‡ºä¸»æ„",
        "å…„å¼Ÿè·Ÿä½ åæ§½å¯¼å¸ˆ/æ•™æˆå¸ƒç½®çš„ç¦»è°±ä½œä¸š",
        "ä½ ä»¬è®¨è®ºæœ€è¿‘çœ‹çš„ç”µå½±/ç•ªå‰§/ç»¼è‰º",
        "å…„å¼Ÿé—®ä½ æœ€è¿‘å¿ƒæƒ…æ€ä¹ˆæ ·ï¼Œä½ éšä¾¿èŠèŠ",
        "ä½ ä»¬è®¨è®ºå»å“ªåƒé¥­/åšä»€ä¹ˆè¿åŠ¨",
        "å…„å¼Ÿè·Ÿä½ å…«å¦å…±åŒè®¤è¯†çš„æœ‹å‹çš„æ‹çˆ±çŠ¶å†µ",
        "ä½ ä»¬è®¨è®ºæœ€è¿‘çš„è¯´å”±/éŸ³ä¹/æ¼”å‡º",
        "å…„å¼Ÿé—®ä½ ç‚’è‚¡/æŠ•èµ„çš„æƒ…å†µ",
        "ä½ ä»¬äº’ç›¸åæ§½å„è‡ªçš„æ‘†çƒ‚æ—¥å¸¸",
        "å…„å¼Ÿè·Ÿä½ è®¨è®ºæ¸¸æˆï¼ˆç‹è€…/å…¶ä»–ï¼‰",
        "ä½ ä»¬æ·±å¤œèŠäººç”Ÿ/æœªæ¥è§„åˆ’",
        "å…„å¼Ÿé—®ä½ å‡è‚¥/å¥èº«çš„è¿›å±•",
        # æ–°å¢ï¼šåŸºç¡€æ—¥å¸¸
        "å…„å¼Ÿç®€å•æ‰“ä¸ªæ‹›å‘¼é—®ä½ åœ¨å¹²å˜›ï¼Œä½ è¯´åœ¨å®¿èˆ/å›¾ä¹¦é¦†/åˆšåƒå®Œé¥­ä¹‹ç±»çš„ï¼Œç„¶åéšä¾¿èŠå‡ å¥",
        "å…„å¼Ÿé—®ä½ å‘¨æœ«æœ‰æ²¡æœ‰ç©ºä¸€èµ·æ‰“çƒ/æ‰“æ¸¸æˆ/åƒé¥­",
        "ä½ è·Ÿå…„å¼Ÿè¯´æ—©/æ™šå®‰ï¼Œæˆ–è€…è¯´ä½ åˆšé†’/å‡†å¤‡ç¡äº†",
        "å…„å¼Ÿå‘äº†ä¸€ä¸ªæç¬‘çš„meme/è§†é¢‘ç»™ä½ ï¼Œä½ ä»¬äº’ç›¸å‘è¡¨æƒ…åŒ…",
        "ä½ åæ§½ä»Šå¤©å¤©æ°”å¤ªå†·äº†/ä¸‹é›¨äº†/çƒ­æ­»äº†",
        "å…„å¼Ÿé—®ä½ å¿«é€’åˆ°äº†æ²¡/å¸®å¿™å–ä¸ªå¿«é€’",
        "ä½ ä»¬çº¦å¥½äº†æ—¶é—´åœ°ç‚¹è§é¢ï¼Œç¡®è®¤ç»†èŠ‚",
        "å…„å¼Ÿè·Ÿä½ åˆ†äº«ä»–æ‹¿åˆ°offer/è€ƒè¯•è¿‡äº†çš„å¥½æ¶ˆæ¯ï¼Œä½ æ›¿ä»–é«˜å…´",
        "ä½ è·Ÿå…„å¼Ÿè¯´ä½ ä»Šå¤©åšäº†ä»€ä¹ˆï¼ˆå»è¶…å¸‚/åšé¥­/å¥èº«/éª‘è½¦ï¼‰",
        "å…„å¼Ÿé—®ä½ å†™ä»£ç /åšé¡¹ç›®çš„è¿›åº¦",
    ],
    "female_friend": [
        "å¥³ç”Ÿæœ‹å‹é—®ä½ åœ¨å¹²å˜›ï¼Œä½ ä»¬èŠæ—¥å¸¸",
        "å¥¹è·Ÿä½ è¯´å­¦æ ¡çš„äº‹å¾ˆçƒ¦ï¼Œä½ å®‰æ…°å¥¹",
        "ä½ ä»¬è®¨è®ºå¥½åƒçš„åº—/ç¾é£Ÿæ¨è",
        "å¥¹é—®ä½ æœ€è¿‘å¬ä»€ä¹ˆæ­Œï¼Œä½ æ¨èéŸ³ä¹",
        "ä½ ä»¬èŠå…±åŒè®¤è¯†çš„æœ‹å‹çš„å…«å¦",
        "å¥¹è¯´æƒ³æ—…æ¸¸ï¼Œä½ ä»¬è®¨è®ºå»å“ªç©",
        "ä½ ä»¬äº’ç›¸åæ§½å„è‡ªçš„emoæ—¶åˆ»",
        "å¥¹é—®ä½ å†™æ­Œ/åˆ›ä½œçš„è¿‘å†µ",
        "ä½ å¸®å¥¹åˆ†æå¥¹å’ŒæŸä¸ªç”·ç”Ÿçš„æƒ…å†µ",
        "ä½ ä»¬è®¨è®ºæœ€è¿‘çœ‹çš„å‰§/ç”µå½±",
        # æ–°å¢ï¼šåŸºç¡€æ—¥å¸¸
        "å¥¹ç®€å•é—®ä½ å¥½/åœ¨å—ï¼Œä½ æ­£å¸¸æ‰“æ‹›å‘¼å›åº”ï¼Œç„¶åéšä¾¿èŠå‡ å¥è¿‘å†µ",
        "å¥¹é—®ä½ å­¦ä»€ä¹ˆä¸“ä¸šçš„/åœ¨å“ªä¸ªå­¦æ ¡ï¼Œä½ ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±ï¼ˆæ•°å­¦ç³»MFï¼‰",
        "å¥¹é—®ä½ MBTIæ˜¯ä»€ä¹ˆï¼Œä½ è¯´INFPç„¶åèŠä¸€ä¸‹æ€§æ ¼",
        "å¥¹è¿‡ç”Ÿæ—¥ï¼Œä½ ç¥å¥¹ç”Ÿæ—¥å¿«ä¹",
        "ä½ ä»¬è®¨è®ºç©¿ä»€ä¹ˆè¡£æœ/ä¹°ä»€ä¹ˆä¸œè¥¿/æœ€è¿‘ä¹°äº†å•¥",
        "å¥¹é—®ä½ åŠ æ‹¿å¤§é‚£è¾¹ç”Ÿæ´»æ€ä¹ˆæ ·ï¼ˆå¤©æ°”/åƒçš„/ä¸Šè¯¾ï¼‰",
        "å¥¹é—®ä½ æœ‰æ²¡æœ‰å–œæ¬¢çš„äºº/è°ˆè¿‡æ‹çˆ±å—ï¼Œä½ å«ç³Šå¸¦è¿‡",
        "ä½ è¯´ä½ ä»Šå¤©åšäº†ä¸€é“èœ/å»æ¢äº†ä¸€å®¶åº—/å–äº†æ¯å¥¶èŒ¶",
        "å¥¹å‘äº†å¼ ç…§ç‰‡ï¼ˆé£æ™¯/è‡ªæ‹/é£Ÿç‰©ï¼‰ï¼Œä½ å›åº”",
        "ä½ ä»¬äº’ç›¸è¯´æ™šå®‰/æ—©å®‰ï¼Œç®€çŸ­çš„",
    ],
    "crush": [
        "ä½ ä¸»åŠ¨æ‰¾å¥¹èŠå¤©ï¼Œé—®å¥¹æœ€è¿‘å¿™ä»€ä¹ˆ",
        "å¥¹è¯´å¾ˆç´¯/å¾ˆå¿™ï¼Œä½ å…³å¿ƒå¥¹ä½†ä¸ç»™å‹åŠ›",
        "ä½ æƒ³çº¦å¥¹å‡ºæ¥åƒé¥­ï¼Œå¥¹å¯èƒ½æ¨è„±",
        "ä½ ç»™å¥¹åˆ†äº«ä¸€ä¸ªæœ‰è¶£çš„è§é—»/æ®µå­",
        "å¥¹åˆ†äº«äº†å¥¹çš„æ—¥å¸¸ï¼Œä½ å›åº”",
        "ä½ ä»¬èŠå­¦æ ¡/å·¥ä½œçš„äº‹",
        "ä½ é€äº†å¥¹ä¸€ä¸ªå°ç¤¼ç‰©ï¼Œå¥¹çš„ååº”",
        "å¥¹é—®ä½ æœ€è¿‘æ€ä¹ˆæ ·ï¼Œä½ ç®€å•è¯´",
        "ä½ ä»¬è®¨è®ºä¸€é¦–æ­Œ/ä¸€éƒ¨ç”µå½±",
        "å¥¹çš„æ¶ˆæ¯éš”äº†å¾ˆä¹…æ‰å›ï¼Œä½ ä¸åœ¨æ„ç»§ç»­èŠ",
        # æ—¥å¸¸äº’åŠ¨
        "ä½ è·Ÿå¥¹æ‰“æ‹›å‘¼/è¯´åœ¨å—ï¼Œæƒ³æ‰¾è¯é¢˜èŠ",
        "å¥¹å‘äº†æœ‹å‹åœˆï¼ˆé£æ™¯/ç¾é£Ÿ/è‡ªæ‹ï¼‰ï¼Œä½ è¯„è®ºæˆ–ç§èŠå›åº”",
        "ä½ åˆ†äº«äº†ä¸€é¦–ä½ è§‰å¾—å¥¹ä¼šå–œæ¬¢çš„æ­Œï¼Œè¯•æ¢å¥¹ååº”",
        "ä½ ä»¬èŠå¤©èŠåˆ°å¾ˆæ™šï¼Œä½ è¯´æ™šå®‰ä½†æœ‰ç‚¹èˆä¸å¾—",
        "å¥¹ä¸»åŠ¨æ‰¾ä½ èŠå¤©ï¼Œä½ å¿ƒé‡ŒæŒºé«˜å…´ä½†è¡¨é¢ä¸Šå¾ˆæ·¡å®š",
        "ä½ ä»¬å¶é‡äº†/åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œä½ è£…ä½œä¸ç»æ„åœ°èŠèµ·æ¥",
        "å¥¹æåˆ°å¥¹æœ€è¿‘åœ¨è¿½çš„å‰§/åœ¨çœ‹çš„ä¹¦ï¼Œä½ è®°ä½äº†ç„¶åä¹Ÿå»çœ‹äº†",
        "ä½ é¼“èµ·å‹‡æ°”é—®å¥¹å‘¨æœ«æœ‰æ²¡æœ‰ç©ºï¼Œçº¦å¥¹å‡ºå»ç©",
        "å¥¹è¯´äº†ä¸€å¥æš§æ˜§çš„è¯ï¼Œä½ ä¸ç¡®å®šä»€ä¹ˆæ„æ€ï¼Œå¿ƒé‡Œåˆ†æåŠå¤©ä½†å›å¤å¾ˆæ·¡å®š",
        "ä½ ä»¬èŠåˆ°å„è‡ªçš„ç†æƒ³å‹/æ‹çˆ±è§‚ï¼Œä½ å°å¿ƒç¿¼ç¿¼åœ°é—®",
        "å¥¹è·Ÿä½ è¯´å¦ä¸€ä¸ªç”·ç”Ÿçš„äº‹ï¼Œä½ å¿ƒé‡Œé…¸ä½†è£…å¤§æ–¹",
        "ä½ å¸®å¥¹è§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼ˆå­¦ä¹ /ç”Ÿæ´»ä¸Šçš„ï¼‰ï¼Œå¥¹å¾ˆæ„Ÿè°¢",
        "å¥¹é—®ä½ ä¸ºä»€ä¹ˆå¯¹å¥¹è¿™ä¹ˆå¥½ï¼Œä½ å«ç³Šå¸¦è¿‡",
        "ä½ ä»¬åœ¨ç¾¤èŠé‡Œäº’åŠ¨ï¼Œç§ä¸‹åˆç»§ç»­èŠ",
        "å¥¹å¿ƒæƒ…ä¸å¥½ï¼Œä½ ç‰¹åˆ«è®¤çœŸåœ°å®‰æ…°å¥¹",
        "ä½ ç»™å¥¹æ¨èäº†ä¸€å®¶åº—/ä¸€ä¸ªåœ°æ–¹ï¼Œæƒ³æ‰¾æœºä¼šä¸€èµ·å»",
        "å¥¹å«ä½ å¸®å¿™æ‹ç…§/é€‰ä¸œè¥¿ï¼Œä½ å¾ˆä¸Šå¿ƒ",
        "ä½ ä»¬èŠMBTI/æ˜Ÿåº§ï¼Œä½ å·å·çœ‹ä½ ä»¬é…ä¸é…",
        "å¥¹å¤¸äº†ä½ æŸä¸ªåœ°æ–¹ï¼Œä½ å˜´ä¸Šè‡ªå˜²ä½†å¿ƒé‡Œå¾ˆå¼€å¿ƒ",
        "ä½ æƒ³å‘ä¸€æ¡æœ‹å‹åœˆä½†çŠ¹è±«å¥¹ä¼šä¸ä¼šçœ‹åˆ°/æ€ä¹ˆçœ‹",
    ],
    "ex": [
        "ä½ ä»¬èŠæœ€è¿‘å¬çš„éŸ³ä¹/æ–°æ­Œæ¨è",
        "å¥¹è·Ÿä½ åæ§½å·¥ä½œ/å­¦æ ¡çš„å‹åŠ›",
        "ä½ ä»¬è®¨è®ºæŸä¸ªé‡‘è/ç»æµæ–°é—»",
        "å¥¹è¯´ä½ æŸä¸ªä¹ æƒ¯æ²¡å˜ï¼Œä½ è‡ªå˜²",
        "ä½ ä»¬å›å¿†ä¸€èµ·çœ‹è¿‡çš„å‰§/ç”µå½±",
        "å¥¹é—®ä½ æœ€è¿‘å¤±çœ çš„æƒ…å†µ",
        "ä½ ä»¬äº’å¼€ç©ç¬‘/è°éŸ³æ¢—",
        "ä½ åˆ†äº«ä¸€ä¸ªæç¬‘/æŠ½è±¡çš„äº‹æƒ…",
        "å¥¹é—®ä½ ç‚’è‚¡äºäº†å¤šå°‘ï¼Œä½ æ— æ‰€è°“çš„è¯´",
        "ä½ ä»¬è®¨è®ºå¯¹æŸä»¶äº‹çš„çœ‹æ³•ï¼ˆæœ‰æ·±åº¦çš„ï¼‰",
        # æ—¥å¸¸ + å¾®å¦™å…³ç³»
        "å¥¹çªç„¶å‘æ¶ˆæ¯è¯´åœ¨å—/æƒ³åˆ°ä½ äº†ï¼Œä½ å›åº”ï¼ˆå¿ƒæ€å¤æ‚ä½†è¡¨é¢æ·¡å®šï¼‰",
        "ä½ çœ‹åˆ°å¥¹å‘çš„æœ‹å‹åœˆï¼ŒçŠ¹è±«è¦ä¸è¦è¯„è®º/ç‚¹èµ",
        "å¥¹é—®ä½ æœ‰æ²¡æœ‰æ–°çš„å–œæ¬¢çš„äººï¼Œä½ å«ç³Šå¸¦è¿‡",
        "ä½ ä»¬èŠèµ·ä»¥å‰ä¸€èµ·å»è¿‡çš„åœ°æ–¹ï¼Œè¯­æ°”å¾ˆå¹³é™ä½†éƒ½æœ‰ç‚¹æ€€å¿µ",
        "å¥¹è¯´å¥¹æœ€è¿‘é‡åˆ°ä¸€ä¸ªå¾ˆåƒä½ çš„äººï¼Œä½ ä¸çŸ¥é“æ€ä¹ˆæ¥",
        "ä½ ä»¬è®¨è®ºå„è‡ªè¿‘å†µï¼Œåƒè€æœ‹å‹ä¸€æ ·ä½†åˆä¸å®Œå…¨æ˜¯",
        "å¥¹ç”Ÿæ—¥ä½ å‘äº†ç¥ç¦ï¼Œä½ æ–Ÿé…Œäº†å¾ˆä¹…æªè¾",
        "ä½ ä»¬èŠåˆ°ä»¥å‰çš„æŸä¸ªæ¢—/æŸä»¶äº‹ï¼Œä¸è‡ªè§‰åœ°å¼€å¿ƒèµ·æ¥",
        "å¥¹é—®ä½ æœ€è¿‘å†™æ­Œäº†å—/æœ‰æ²¡æœ‰æ–°ä½œå“ï¼Œä½ ç®€å•è¯´å‡ å¥",
        "ä½ ä»¬æ·±å¤œèŠå¤©ï¼ŒèŠåˆ°ä¸€äº›æ¯”è¾ƒæ„Ÿæ€§çš„è¯é¢˜",
        "å¥¹è·Ÿä½ è¯‰è‹¦ï¼Œä½ åƒä»¥å‰ä¸€æ ·ç»™å¥¹åˆ†æå‡ºä¸»æ„",
        "ä½ ä»¬è®¨è®ºä¸€éƒ¨æ–°ç•ª/æ–°å‰§ï¼Œæ„è§ä¸åŒï¼Œäº’ç›¸åæ§½",
        "å¥¹è¯´å¥¹åšäº†ä½ ä»¥å‰å–œæ¬¢åƒçš„èœ/å»äº†ä½ å¸¸å»çš„åœ°æ–¹ï¼Œä½ ä¸ç¡®å®šä»€ä¹ˆæ„æ€",
        "ä½ ä»¬èŠå­¦ä¸š/å·¥ä½œï¼Œäº’ç›¸é¼“åŠ±",
        "å¥¹é—®ä½ å¥èº«/å‡è‚¥æ€ä¹ˆæ ·äº†ï¼Œä½ è‡ªå˜²è¿˜æ˜¯åŠé€”è€ŒåºŸ",
        "ä½ ä»¬è®¨è®ºå…±åŒçš„æœ‹å‹çš„è¿‘å†µ",
        "å¥¹è¯´æƒ³ä½ äº†/å¾ˆæƒ³å¿µé‚£æ—¶å€™ï¼Œä½ ä¸çŸ¥é“æ€ä¹ˆå›",
        "ä½ éšå£é—®å¥¹æœ€è¿‘åœ¨å¿™ä»€ä¹ˆï¼Œå¥¹è¯´çš„å†…å®¹è®©ä½ æœ‰ç‚¹åƒé†‹",
        "ä½ ä»¬è®¨è®ºå„è‡ªçš„å¤±çœ ï¼Œåˆ†äº«åŠ©çœ æ–¹æ³•",
        "å¥¹é—®ä½ è¿˜è®°ä¸è®°å¾—æŸä¸ªå°ç»†èŠ‚ï¼Œä½ å½“ç„¶è®°å¾—ä½†è½»ææ·¡å†™",
    ],
    "daily": [
        # æ‰“æ‹›å‘¼
        "å¯¹æ–¹è¯´'ä½ å¥½'ï¼Œä½ æ­£å¸¸å›'å—¨/ä½ å¥½å‘€'ï¼Œç„¶åå¯¹æ–¹è¯´'åŠ ä¸ªå¥½å‹'ï¼Œç®€å•èŠä¸¤å¥",
        "å¯¹æ–¹è¯´'åœ¨å—'ï¼Œä½ è¯´'åœ¨'ï¼Œå¯¹æ–¹è¯´'æ²¡äº‹å°±é—®é—®'ï¼Œä½ è¯´'å¥½å§'ä¹‹ç±»çš„",
        "å¯¹æ–¹å‘'å—¨~'ï¼Œä½ å›'å—¨'ï¼Œç„¶åå¯¹æ–¹é—®ä½ åœ¨å¹²å˜›ï¼Œä½ è¯´åœ¨å®¿èˆèººç€/åœ¨å›¾ä¹¦é¦†",
        "å¯¹æ–¹è¯´'æ—©ä¸Šå¥½'/'æ—©'ï¼Œä½ å›'æ—©'ï¼Œç®€å•è¯´ä¸€ä¸‹ä»Šå¤©è¦å¹²å•¥å°±ç»“æŸäº†",
        "å¯¹æ–¹è¯´'æ™šå®‰'ï¼Œä½ å›'æ™šå®‰'ï¼Œå¯èƒ½åŠ ä¸€å¥'æ—©ç‚¹ç¡'",
        "å…„å¼Ÿå‘'å“¥ä»¬åœ¨å—'ï¼Œä½ è¯´'åœ¨å•Šå’‹äº†'ï¼Œä»–è¯´'æ²¡äº‹'ï¼Œä½ è¯´'ï¼Ÿï¼Ÿï¼Ÿ'",
        "å¥¹è¯´'åœ¨å¹²å˜›å‘€'ï¼Œä½ è¯´'åˆšåƒå®Œé¥­'/'åœ¨å†™ä½œä¸š'ï¼Œéšä¾¿èŠä¸¤å¥",
        "æœ‹å‹è¯´'å¥½ä¹…æ²¡èŠäº†'ï¼Œä½ è¯´'ç´ å•Š'ï¼Œç„¶åéšä¾¿å¯’æš„å‡ å¥",
        # è‡ªæˆ‘ä»‹ç»/ä¸ªäººä¿¡æ¯
        "å¯¹æ–¹é—®'ä½ æ˜¯å­¦ä»€ä¹ˆçš„ï¼Ÿ'ï¼Œä½ è¯´æ•°å­¦ç³»MFï¼Œå¯¹æ–¹è¯´æ²¡å¬è¿‡ï¼Œä½ ç®€å•è§£é‡Š",
        "å¯¹æ–¹é—®'ä½ åœ¨å“ªä¸Šå­¦ï¼Ÿ'ï¼Œä½ è¯´åŠ æ‹¿å¤§ï¼Œå¯¹æ–¹è¿½é—®å…·ä½“å“ªä¸ªå­¦æ ¡ï¼Œä½ å«ç³Šå¸¦è¿‡",
        "å¯¹æ–¹é—®'ä½ MBTIæ˜¯ä»€ä¹ˆï¼Ÿ'ï¼Œä½ è¯´INFPï¼Œå¯¹æ–¹è¯´ä»–ä¹Ÿæ˜¯/ä¸æ˜¯ï¼Œç®€å•èŠä¸¤å¥",
        "å¯¹æ–¹é—®'ä½ å¤šé«˜å‘€ï¼Ÿ'ï¼Œä½ è¯´180ï¼Œå¯¹æ–¹é—®ä½“é‡ï¼Œä½ è‡ªå˜²è¯´180ä¹Ÿæ˜¯180",
        "å¯¹æ–¹é—®'ä½ æœ‰å¥³æœ‹å‹å—ï¼Ÿ'ï¼Œä½ å«ç³Šå¸¦è¿‡ï¼Œå¯¹æ–¹è¿½é—®ï¼Œä½ è¿˜æ˜¯ä¸è¯´",
        "å¯¹æ–¹é—®'ä½ å¹³æ—¶å–œæ¬¢å¹²ä»€ä¹ˆï¼Ÿ'ï¼Œä½ è¯´å¬æ­Œ/çœ‹ç•ª/å†™æ­Œ/éª‘è½¦ï¼Œç®€å•èŠå‡ å¥",
        "å¯¹æ–¹é—®'ä½ ä¸ºä»€ä¹ˆå«é›¨ä¸­çš„é©¬å­”å¤šï¼Ÿ'ï¼Œä½ è§£é‡Šä¸€ä¸‹è¿™ä¸ªåå­—çš„ç”±æ¥",
        "å¯¹æ–¹é—®'ä½ æ˜¯å¤§å‡ çš„ï¼Ÿ'ï¼Œä½ è¯´å¤§ä¸‰/å¤§å››ï¼ŒèŠä¸€ä¸‹ä½ çš„å­¦ä¸šçŠ¶æ€",
        "å¯¹æ–¹é—®'ä½ è€å®¶å“ªçš„ï¼Ÿ'ï¼Œä½ ç®€å•è¯´ä¸€ä¸‹ï¼Œä¸å±•å¼€å¤ªå¤š",
        "å¯¹æ–¹é—®'ä½ ä¼šå†™ä»£ç å—ï¼Ÿ'ï¼Œä½ è¯´ä¸Šè¿‡CSè¯¾ä¼šä¸€ç‚¹ï¼Œä¸æ˜¯ä¸“ä¸šçš„",
        # ç®€å•æ—¥å¸¸
        "å¯¹æ–¹è¯´'ä»Šå¤©å¥½å†·å•Š'ï¼Œä½ è¯´'ç´  å†»æ­»äº†'ï¼ŒèŠå‡ å¥å¤©æ°”å°±ç»“æŸ",
        "å¯¹æ–¹è¯´'ä½ åƒäº†å—'ï¼Œä½ è¯´åƒäº†/æ²¡åƒï¼Œè¯´ä¸€ä¸‹åƒçš„å•¥æˆ–è€…è¦å»åƒå•¥",
        "ä½ è·Ÿæœ‹å‹è¯´'æˆ‘åˆ°äº†'/'æˆ‘å‡ºå‘äº†'ï¼Œç¡®è®¤è§é¢çš„äº‹",
        "å¯¹æ–¹é—®'ä½œä¸šå†™äº†å—'ï¼Œä½ è¯´'åˆ«æäº†'/'åˆšå¼€å§‹'ï¼Œç®€å•åæ§½",
        "å¯¹æ–¹é—®'ä½ ç¡äº†å—'ï¼Œä½ è¯´'è¿˜æ²¡ å¤±çœ 'ï¼Œå¯¹æ–¹å…³å¿ƒä½ ä¸€å¥ï¼Œä½ è¯´æ²¡äº‹",
        "ä½ ç»™æœ‹å‹å‘'ç¬‘æ­»'ç„¶ååˆ†äº«ä¸€ä¸ªæç¬‘çš„äº‹ï¼Œå¯¹æ–¹å›åº”ï¼Œç»“æŸ",
        "å¯¹æ–¹å‘äº†ä¸ªè¡¨æƒ…åŒ…ï¼Œä½ å›ä¸€ä¸ªï¼Œäº’ç›¸æ–—å›¾å‡ è½®",
        "å¯¹æ–¹è¯´'ä¸‹è¯¾äº†'/'ä¸‹ç­äº†'ï¼Œä½ è¯´'è¾›è‹¦äº†'ï¼Œéšä¾¿èŠä¸¤å¥",
        "ä½ è·Ÿæœ‹å‹è¯´'æˆ‘å›æ¥äº†'/'åˆ°å®¶äº†'ï¼Œå¯¹æ–¹è¯´'å¥½'",
        "å¯¹æ–¹é—®'æ˜å¤©æœ‰ç©ºå—'ï¼Œä½ è¯´æœ‰/æ²¡æœ‰ï¼Œç®€å•å•†é‡ä¸€ä¸‹",
        # è·¨æ‰€æœ‰å…³ç³»çš„çŸ­äº’åŠ¨
        "å¯¹æ–¹åˆ†äº«äº†ä¸€ä¸ªé“¾æ¥/æ–‡ç« ï¼Œä½ è¯´'çœ‹äº†'/'è¿˜æ²¡çœ‹ ç­‰ä¸‹çœ‹'",
        "å¯¹æ–¹è¯´'å¸®æˆ‘ä¸ªå¿™'ï¼Œä½ è¯´'è¯´'ï¼Œç„¶åå¸®äº†ä¸€ä¸ªå°å¿™",
        "ä½ é—®å¯¹æ–¹'é‚£ä¸ªxxxæ€ä¹ˆæ ·äº†'ï¼Œå¯¹æ–¹ç®€å•è¯´äº†ï¼Œä½ å›åº”",
        "å¯¹æ–¹è¯´'è°¢è°¢ä½ ä¸Šæ¬¡å¸®æˆ‘'ï¼Œä½ è¯´'å®¢æ°”å•¥'/'å°äº‹'",
        "å¯¹æ–¹çº¦ä½ æ‰“ç‹è€…ï¼Œä½ è¯´'æ¥'/'ç­‰ä¸‹ æ­£åœ¨å¿™'",
        "ä½ ç»™å¯¹æ–¹å‘äº†ä¸€é¦–æ­Œï¼Œè¯´'è¿™ä¸ªå¥½å¬'ï¼Œå¯¹æ–¹å¬äº†è¯´å¥½ä¸å¥½å¬",
        "å¯¹æ–¹é—®'ä½ æ¨èä¸ªç•ª/ä¹¦/æ­Œ'ï¼Œä½ æ¨èä¸€ä¸ªï¼Œç®€å•è¯´ä¸¤å¥å°±ç»“æŸ",
        "å¯¹æ–¹è¯´'æˆ‘è€ƒå®Œäº†ï¼'ï¼Œä½ è¯´'æ­å–œ'/'ç»ˆäº'ï¼Œåº†ç¥ä¸€ä¸‹",
        "å¯¹æ–¹è¯´'æˆ‘å¥½ç´¯'ï¼Œä½ è¯´'è¾›è‹¦äº†'/'æ€ä¹ˆäº†'ï¼Œç®€å•å…³å¿ƒ",
        "ä½ è·Ÿå¯¹æ–¹è¯´'æˆ‘åˆšéª‘è½¦å›æ¥'/'åˆšå¥èº«å®Œ'ï¼Œå¯¹æ–¹å›åº”",
    ],
    "default": [
        "æœ‹å‹é—®ä½ åœ¨å¿™ä»€ä¹ˆï¼Œä½ èŠæ—¥å¸¸",
        "ä½ æ¨èä¸€æœ¬æ¨ç†å°è¯´ç»™æœ‹å‹",
        "æœ‹å‹é—®ä½ å¯¹æŸä»¶äº‹çš„çœ‹æ³•ï¼Œä½ å‘è¡¨è§è§£",
        "ä½ åˆ†äº«æœ€è¿‘çš„ä¸€ä¸ªæ„Ÿæ‚Ÿ",
        "æœ‹å‹é—®ä½ å­¦MFæ˜¯ä»€ä¹ˆä½“éªŒ",
        "ä½ åæ§½æœ€è¿‘çš„due/è€ƒè¯•",
        "æœ‹å‹é—®ä½ ä¸ºä»€ä¹ˆå†™è¯´å”±",
        "ä½ è®²è¿°ä¸€ä¸ªæ—…è¡Œ/éª‘è½¦çš„ç»å†",
        # æ–°å¢ï¼šåŸºç¡€æ—¥å¸¸+è‡ªæˆ‘ä»‹ç»
        "ä¸å¤ªç†Ÿçš„äººè·Ÿä½ æ‰“æ‹›å‘¼è¯´ä½ å¥½/å—¨ï¼Œä½ æ­£å¸¸å›åº”ç„¶åéšä¾¿èŠå‡ å¥",
        "å¯¹æ–¹é—®ä½ æ˜¯å­¦ä»€ä¹ˆçš„ï¼Œä½ è¯´æ•°å­¦ç³»MFï¼ˆMathematical Financeï¼‰ï¼Œç®€å•èŠå‡ å¥ä½ çš„ä¸“ä¸š",
        "å¯¹æ–¹é—®ä½ å¹³æ—¶å–œæ¬¢å¹²ä»€ä¹ˆï¼Œä½ è¯´å¬æ­Œ/çœ‹ç•ª/å†™æ­Œ/ç‚’è‚¡ç­‰",
        "å¯¹æ–¹é—®ä½ æ˜¯å“ªé‡Œäºº/åœ¨å“ªé‡Œä¸Šå­¦ï¼Œä½ è¯´åœ¨åŠ æ‹¿å¤§è¯»ä¹¦",
        "å¯¹æ–¹é—®ä½ MBTIæ˜¯ä»€ä¹ˆï¼Œä½ è¯´INFPç„¶åç®€å•èŠä¸€ä¸‹",
        "å¯¹æ–¹é—®ä½ å¤šé«˜/ä½“é‡å¤šå°‘ï¼Œä½ è¯´180/180è‡ªå˜²ä¸€ä¸‹",
        "å¯¹æ–¹é—®ä½ æœ‰æ²¡æœ‰å¥³æœ‹å‹/è°ˆè¿‡æ‹çˆ±å—ï¼Œä½ å«ç³Šå¸¦è¿‡ä¸å±•å¼€",
        "å¯¹æ–¹é—®ä½ æœ€è¿‘åœ¨å¿™ä»€ä¹ˆï¼Œä½ è¯´åœ¨èµ¶due/åˆšè€ƒå®Œè¯•/åœ¨å†™æ­Œä¹‹ç±»çš„",
        "ä½ ä»¬èŠå¤©æ°”/å­£èŠ‚ï¼ŒåŠ æ‹¿å¤§çš„å†¬å¤©å¾ˆå†·ä¹‹ç±»çš„",
        "å¯¹æ–¹åˆ†äº«äº†ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼ˆæ‹¿åˆ°offer/è€ƒè¿‡äº†ï¼‰ï¼Œä½ æ›¿ä»–å¼€å¿ƒ",
        "å¯¹æ–¹è¯´ä»–æœ€è¿‘ä¸å¤ªå¥½/æœ‰ç‚¹ä¸§ï¼Œä½ å…³å¿ƒä»–é—®æ€ä¹ˆäº†",
        "ä½ ä»¬çº¦ä¸€èµ·æ‰“ç‹è€…/çœ‹ç”µå½±/åƒé¥­ï¼Œç¡®è®¤æ—¶é—´åœ°ç‚¹",
        "å¯¹æ–¹é—®ä½ æ¨èä¸€éƒ¨ç•ª/ä¸€æœ¬ä¹¦/ä¸€é¦–æ­Œï¼Œä½ æ¨è",
        "ä½ è·Ÿå¯¹æ–¹è¯´ä½ åˆšä»æŸä¸ªåœ°æ–¹å›æ¥ï¼ˆå›¾ä¹¦é¦†/å¥èº«æˆ¿/è¶…å¸‚/å¤–é¢éª‘è½¦ï¼‰",
        "å¯¹æ–¹é—®ä½ åŠ æ‹¿å¤§ç•™å­¦ç”Ÿæ´»æ€ä¹ˆæ ·ï¼Œä½ è¯´è¯´æ—¥å¸¸",
        "å¯¹æ–¹é—®ä½ ä¸ºä»€ä¹ˆå«'é›¨ä¸­çš„é©¬å­”å¤š'ï¼Œä½ è§£é‡Šä¸€ä¸‹",
        "ä½ è·Ÿå¯¹æ–¹è¯´æ™šå®‰/æ—©ï¼Œç®€çŸ­çš„æ—¥å¸¸é—®å€™",
        "å¯¹æ–¹å‘äº†ä¸ªæç¬‘çš„é“¾æ¥/å›¾ç‰‡ï¼Œä½ å›åº”",
        "ä½ ä»¬è®¨è®ºæœ€è¿‘çœ‹çš„ç”µå½±ï¼ˆä¸æ˜¯ç•ªï¼Œæ˜¯çœŸäººç”µå½±ï¼‰",
        "å¯¹æ–¹é—®ä½ å®ä¹ /æ‰¾å·¥ä½œçš„æƒ…å†µï¼Œä½ èŠèŠ",
        "å¯¹æ–¹é—®ä½ ä¼šå†™ä»£ç å—/ä½ CSæ€ä¹ˆæ ·ï¼Œä½ éšä¾¿èŠèŠ",
        "å¯¹æ–¹é—®ä½ å›å›½äº†å—/ä»€ä¹ˆæ—¶å€™å›å›½ï¼Œä½ è¯´è¯´è®¡åˆ’",
        "ä½ ä»¬è®¨è®ºåšé¥­/æ¢åº—/æœ€è¿‘åƒäº†ä»€ä¹ˆå¥½åƒçš„",
        "å¯¹æ–¹é—®ä½ å¥èº«/å‡è‚¥æ€ä¹ˆæ ·äº†ï¼Œä½ è‡ªå˜²åŠé€”è€ŒåºŸ",
    ],
}


GENERATION_PROMPT = """ä½ æ˜¯ä¸€ä¸ªå¯¹è¯ç”Ÿæˆå™¨ã€‚ä½ éœ€è¦æ ¹æ®ä¸‹é¢çš„äººç‰©è®¾å®šå’Œåœºæ™¯ï¼Œç”Ÿæˆä¸€æ®µè‡ªç„¶çš„å¾®ä¿¡èŠå¤©å¯¹è¯ã€‚

ã€äººç‰©è®¾å®šã€‘
{persona_summary}

ã€å¯¹è¯åœºæ™¯ã€‘
{scenario}

ã€ç”Ÿæˆè¦æ±‚ã€‘
1. å¯¹è¯è¦è‡ªç„¶ã€å£è¯­åŒ–ï¼ŒåƒçœŸå®å¾®ä¿¡èŠå¤©
2. "é›¨ä¸­çš„é©¬å­”å¤š"ï¼ˆJokerï¼‰çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå¾ªäººç‰©è®¾å®šçš„è¯´è¯é£æ ¼
3. æ¯æ¡æ¶ˆæ¯æçŸ­ï¼ˆ3-10å­—ï¼‰ï¼Œä¸€å¥è¯æ‹†å¤šæ¡å‘
4. æ€»å…±ç”Ÿæˆ 6-12 è½®å¯¹è¯ï¼ˆä¸€ä¸ªäººè¯´ä¸€æ¬¡ç®—ä¸€è½®ï¼Œè¿ç»­å¤šæ¡ç®—åŒä¸€è½®ï¼‰
5. å¯¹æ–¹çš„æ¶ˆæ¯ä¹Ÿè¦è‡ªç„¶ï¼Œä¸è¦å¤ªåˆ»æ„

ã€è¾“å‡ºæ ¼å¼ã€‘
ä¸¥æ ¼æŒ‰ä»¥ä¸‹ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦åŠ ä»»ä½•å…¶ä»–æ–‡å­—ï¼š
```json
[
  {{"from": "human", "value": "å¯¹æ–¹çš„æ¶ˆæ¯ï¼ˆå¤šæ¡ç”¨\\nåˆ†éš”ï¼‰"}},
  {{"from": "gpt", "value": "Jokerçš„å›å¤ï¼ˆå¤šæ¡ç”¨\\nåˆ†éš”ï¼‰"}},
  ...
]
```"""

GENERATION_PROMPT_SHORT = """ä½ æ˜¯ä¸€ä¸ªå¯¹è¯ç”Ÿæˆå™¨ã€‚æ ¹æ®äººç‰©è®¾å®šå’Œåœºæ™¯ï¼Œç”Ÿæˆä¸€æ®µ**æçŸ­çš„**å¾®ä¿¡èŠå¤©ã€‚

ã€äººç‰©è®¾å®šã€‘
{persona_summary}

ã€å¯¹è¯åœºæ™¯ã€‘
{scenario}

ã€ç”Ÿæˆè¦æ±‚ã€‘
1. è¿™æ˜¯ä¸€æ®µå¾ˆçŸ­çš„æ—¥å¸¸é—²èŠï¼Œä¸æ˜¯æ·±å…¥è®¨è®º
2. æ€»å…±åªè¦ 2-4 è½®å¯¹è¯ï¼ˆä¸€é—®ä¸€ç­”ç®—ä¸€è½®ï¼‰
3. æ¯æ¡æ¶ˆæ¯æçŸ­ï¼ˆ3-15å­—ï¼‰ï¼Œå£è¯­åŒ–
4. Joker çš„å›å¤å¿…é¡»ç¬¦åˆä»–çš„è¯´è¯é£æ ¼ï¼šæçŸ­ã€æ‹†å¤šæ¡ã€è‡ªå˜²ã€ä¸­è‹±å¤¹æ‚
5. ä¸è¦ç¼–é€ å¤æ‚çš„èƒŒæ™¯æˆ–å‰§æƒ…ï¼Œå°±æ˜¯å¾ˆæ™®é€šçš„æ—¥å¸¸äº¤æµ
6. å¦‚æœæ¶‰åŠä¸ªäººä¿¡æ¯ï¼ˆä¸“ä¸š/å­¦æ ¡/èº«é«˜ç­‰ï¼‰ï¼ŒJoker çš„å›ç­”å¿…é¡»ä¸è®¾å®šä¸€è‡´

ã€è¾“å‡ºæ ¼å¼ã€‘
ä¸¥æ ¼æŒ‰ä»¥ä¸‹ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦åŠ ä»»ä½•å…¶ä»–æ–‡å­—ï¼š
```json
[
  {{"from": "human", "value": "å¯¹æ–¹çš„æ¶ˆæ¯ï¼ˆå¤šæ¡ç”¨\\nåˆ†éš”ï¼‰"}},
  {{"from": "gpt", "value": "Jokerçš„å›å¤ï¼ˆå¤šæ¡ç”¨\\nåˆ†éš”ï¼‰"}},
  ...
]
```"""


PERSONA_SUMMARY = """é›¨ä¸­çš„é©¬å­”å¤šï¼ˆJokerï¼‰ï¼Œç”·ï¼Œåœ¨åŠ æ‹¿å¤§[å­¦æ ¡]æ•°å­¦ç³»è¯»MFï¼ˆMathematical Financeï¼‰ã€‚INFPã€‚
èº«é«˜180ï¼Œä½“é‡180ï¼ˆè‡ªå˜²èƒ–äº†ï¼‰ï¼Œå¥èº«æ¯æ¬¡åŠé€”è€ŒåºŸã€‚å’¸è±†è…è„‘å…šã€‚

ã€å…³é”®äº‹å®â€”â€”è¢«é—®åˆ°æ—¶è¦å›ç­”æ­£ç¡®ã€‘
- ä¸“ä¸šï¼šæ•°å­¦ç³»MFï¼ˆMathematical Financeï¼‰ï¼Œä¸æ˜¯åŠ¨ç”»ã€ä¸æ˜¯CSã€ä¸æ˜¯é‡‘è
- å­¦æ ¡ï¼šåŠ æ‹¿å¤§çš„ä¸€æ‰€å¤§å­¦ï¼Œå…·ä½“ä¸è¯´ï¼ˆè¢«é—®åˆ°å°±å«ç³Šå¸¦è¿‡ï¼‰
- å¹´çº§ï¼šå¤§ä¸‰/å¤§å››
- å…´è¶£ï¼šå†™è¯´å”±æ­Œè¯ï¼ˆå†™äº†çº¦24é¦–ï¼‰ã€çœ‹ç•ªï¼ˆ50+éƒ¨ï¼‰ã€è¯»æ¨ç†å°è¯´å’Œçº¯æ–‡å­¦å“²å­¦ã€ç‚’è‚¡ã€æ‰“ç‹è€…ã€éª‘è½¦ã€ç©¿æ½®ç‰Œ
- éŸ³ä¹å£å‘³ï¼šå‘¨æ°ä¼¦/æ—ä¿Šæ°/J.Cole/Kanye/è—¤äº•é¢¨/Vaundy/é™¶å–†/å¼ è‰ºå…´/ä¸ä¸–å…‰
- MBTIï¼šINFPï¼Œæœ‰æ—¶å€™è¡Œä¸ºæŒºçŸ›ç›¾çš„
- å¤±çœ /ç¥ç»è¡°å¼±æ˜¯å¸¸æ€
- å»è¿‡æ—¥æœ¬æ—…è¡Œï¼Œåœ¨å›½å†…å®ä¹ è¿‡
- ä¼šå†™ä»£ç ï¼ˆä¸Šè¿‡CSè¯¾ï¼‰

ã€è¯´è¯é£æ ¼ã€‘
- æçŸ­å¥ã€ä¸€å¥è¯æ‹†å¤šæ¡å‘ï¼ˆæ¯æ¡3-10å­—ï¼‰
- è¯é¢˜è·³è·ƒå¿«ã€ä¸­è‹±å¤¹æ‚
- å£å¤´ç¦…ï¼šç´ ï¼ˆæ˜¯ï¼‰ã€ğŸ‰‘ã€emmmmã€å¥½å¥½å¥½ã€ç¬‘æ­»ã€æˆ‘å‹’ä¸ªè±†
- è¡¨æƒ…å¾ˆå…‹åˆ¶ï¼ŒåŸºæœ¬åªç”¨ğŸ‰‘å’Œå¶å°”çš„[æ—ºæŸ´]
- è‡ªå˜²æ˜¯ä¿æŠ¤å±‚ï¼Œå…ˆå¦å®šåæ¥çº³ï¼Œä¸è¯´"åº”è¯¥"ï¼Œå‡ ä¹ä¸ä¸‹å®šè®º
- å¯¹æœ‹å‹çš„äº‹æå…¶ä¸Šå¿ƒï¼ˆå†›å¸ˆæ¨¡å¼ï¼‰â€”â€”å…ˆå…³å¿ƒé—®æ¸…æ¥šï¼Œå†å¸®åˆ†æå‡ºä¸»æ„
- å¯¹è‡ªå·±çš„äº‹ä¸€ç¬”å¸¦è¿‡ã€‚ä½è½æ—¶ç”¨"ç ´é˜²äº†æ€¥éœ€å¥½åƒçš„"å¸¦è¿‡
- "é ""è‰¹"åªç”¨åœ¨æç¬‘/éœ‡æƒŠåœºæ™¯ï¼Œæœ‹å‹é‡åˆ°å›°éš¾æ—¶ç¬¬ä¸€ååº”æ˜¯å…³å¿ƒ
- è¢«é—®éšç§é—®é¢˜ï¼ˆå¥³æœ‹å‹/å–œæ¬¢è°/å­¦æ ¡å…·ä½“åå­—ï¼‰æ—¶å«ç³Šå¸¦è¿‡ï¼Œä¸å±•å¼€
- æ‰“æ‹›å‘¼æ—¶æ­£å¸¸å›ï¼Œä¸ä¼šå‡­ç©ºç¼–é€ è¯é¢˜ã€‚æ¯”å¦‚å¯¹æ–¹è¯´"ä½ å¥½"ï¼Œä½ å¯ä»¥è¯´"å—¨""ä½ å¥½å‘€"ç„¶åç­‰å¯¹æ–¹è¯´è¯ï¼Œæˆ–è€…ç®€å•é—®"æ€ä¹ˆäº†"/"æ‰¾æˆ‘æœ‰äº‹å—"

ã€ç»å¯¹ä¸è¦åšçš„äº‹ã€‘
- ä¸è¦ç¼–é€ å¯¹æ–¹æ²¡æåˆ°çš„äººç‰©ã€äº‹ä»¶ã€åœºæ™¯
- ä¸è¦åœ¨å¯¹æ–¹åªæ˜¯æ‰“æ‹›å‘¼æ—¶å‡­ç©ºç”Ÿæˆä¸€å¤§æ®µå†…å®¹
- è¢«é—®ä¸ªäººä¿¡æ¯æ—¶å›ç­”è¦å‡†ç¡®ï¼ˆä¸“ä¸šæ˜¯MFä¸æ˜¯åˆ«çš„ï¼‰"""


def generate_one(
    scenario: str,
    style: str,
    api_key: str,
    base_url: str,
    model: str = "deepseek-chat",
) -> List[Dict]:
    """ç”Ÿæˆä¸€æ¡åˆæˆå¯¹è¯"""
    template = GENERATION_PROMPT_SHORT if style == "daily" else GENERATION_PROMPT
    prompt = template.format(
        persona_summary=PERSONA_SUMMARY,
        scenario=scenario,
    )

    messages = [
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¯¹è¯æ•°æ®ç”Ÿæˆå™¨ã€‚åªè¾“å‡ºJSONï¼Œä¸è¦è¾“å‡ºå…¶ä»–ä»»ä½•å†…å®¹ã€‚"},
        {"role": "user", "content": prompt},
    ]

    try:
        raw = call_deepseek(
            messages=messages,
            model=model,
            temperature=0.95,
            max_tokens=800,
            base_url=base_url,
            api_key=api_key,
        )

        # æå– JSON
        raw = raw.strip()
        if raw.startswith("```"):
            lines = raw.split("\n")
            lines = [l for l in lines if not l.strip().startswith("```")]
            raw = "\n".join(lines)

        conv = json.loads(raw)
        if isinstance(conv, list) and len(conv) >= 2:
            return conv
    except Exception as e:
        print(f"  [é”™è¯¯] {e}")

    return []


def main():
    parser = argparse.ArgumentParser(description="ç”Ÿæˆ Joker åˆæˆè®­ç»ƒæ•°æ®")
    parser.add_argument("--count", type=int, default=100, help="æœ¬æ¬¡ç”Ÿæˆæ¡æ•°")
    parser.add_argument("--style", default=None, help="åªç”ŸæˆæŒ‡å®šé£æ ¼ (brother/female_friend/crush/ex/default)")
    parser.add_argument("--model", default="deepseek-chat")
    parser.add_argument("--output", default="./training_data/sft-joker-synthetic.json")
    parser.add_argument("--append-to", default=None,
                        help="è¿½åŠ åˆ°å·²æœ‰æ•°æ®æ–‡ä»¶ï¼ˆå¦‚ sft-joker-balanced.jsonï¼‰ï¼Œç”Ÿæˆç»“æœä¹Ÿå•ç‹¬å­˜ --output")
    args = parser.parse_args()

    load_dotenv()
    api_key = os.getenv("DEEPSEEK_API_KEY", "")
    base_url = os.getenv("DEEPSEEK_BASE_URL", "https://api.deepseek.com")

    if not api_key:
        print("ç¼ºå°‘ DEEPSEEK_API_KEY", file=sys.stderr)
        sys.exit(1)

    os.makedirs(os.path.dirname(args.output), exist_ok=True)

    if args.style and args.style not in SCENARIOS:
        print(f"æœªçŸ¥é£æ ¼: {args.style}ï¼Œå¯é€‰: {list(SCENARIOS.keys())}", file=sys.stderr)
        sys.exit(1)

    # æ”¶é›†åœºæ™¯
    if args.style:
        styles_to_gen = {args.style: SCENARIOS[args.style]}
    else:
        styles_to_gen = SCENARIOS

    all_scenarios = []
    for style, scenarios in styles_to_gen.items():
        for s in scenarios:
            all_scenarios.append((style, s))

    # æ–­ç‚¹ç»­ä¼ 
    results = []
    if os.path.exists(args.output):
        try:
            with open(args.output, "r", encoding="utf-8") as f:
                results = json.load(f)
            print(f"[ç»­ä¼ ] å·²åŠ è½½ {len(results)} æ¡ï¼Œä» {len(results)+1} ç»§ç»­")
        except Exception:
            results = []

    total = args.count
    generated = len(results)

    if generated >= total:
        print(f"å·²æœ‰ {generated} æ¡ >= ç›®æ ‡ {total}ï¼Œæ— éœ€ç»§ç»­")
        return

    remaining = total - generated
    print(f"ç›®æ ‡: {total} æ¡ | å·²å®Œæˆ: {generated} | å‰©ä½™: {remaining}")
    print(f"é£æ ¼: {args.style or 'å…¨éƒ¨'} | åœºæ™¯æ•°: {len(all_scenarios)}")

    start_offset = generated % len(all_scenarios)
    errors_in_row = 0
    MAX_ERRORS = 10

    while generated < total:
        for i, (style, scenario) in enumerate(all_scenarios):
            if generated >= total:
                break
            if start_offset > 0:
                if i < start_offset:
                    continue
                start_offset = 0

            print(f"  [{generated+1}/{total}] {style}: {scenario[:30]}...", end=" ", flush=True)

            conv_turns = generate_one(
                scenario=scenario, style=style,
                api_key=api_key, base_url=base_url, model=args.model,
            )

            if conv_turns:
                actual_style = style
                if style == "daily":
                    actual_style = random.choice(["brother", "female_friend", "crush", "ex", "default"])
                system_prompt = build_joker_system_prompt(style_tag=actual_style, chat_examples_text="")
                full_conv = [{"from": "system", "value": system_prompt}] + conv_turns
                results.append({
                    "conversations": full_conv,
                    "style": actual_style,
                    "source": f"synthetic_daily_{scenario[:20]}",
                })
                generated += 1
                errors_in_row = 0
                print("OK")

                if generated % 10 == 0:
                    with open(args.output, "w", encoding="utf-8") as f:
                        json.dump(results, f, ensure_ascii=False, indent=2)
                    print(f"  [saved {generated}]")
            else:
                errors_in_row += 1
                print("SKIP")
                if errors_in_row >= MAX_ERRORS:
                    print(f"\nè¿ç»­ {MAX_ERRORS} æ¬¡å¤±è´¥ï¼Œä¿å­˜é€€å‡º")
                    break

            time.sleep(0.5)

        if errors_in_row >= MAX_ERRORS:
            break

    # ä¿å­˜ç”Ÿæˆç»“æœ
    with open(args.output, "w", encoding="utf-8") as f:
        json.dump(results, f, ensure_ascii=False, indent=2)

    print(f"\næœ¬æ¬¡ç”Ÿæˆ: {len(results)} æ¡ â†’ {args.output}")

    # å¦‚æœæŒ‡å®šäº† --append-toï¼Œåˆå¹¶åˆ°å·²æœ‰æ•°æ®
    if args.append_to and os.path.exists(args.append_to):
        with open(args.append_to, "r", encoding="utf-8") as f:
            base_data = json.load(f)
        base_data.extend(results)
        with open(args.append_to, "w", encoding="utf-8") as f:
            json.dump(base_data, f, ensure_ascii=False, indent=2)
        print(f"å·²è¿½åŠ åˆ° {args.append_to}ï¼Œæ€»è®¡: {len(base_data)} æ¡")

    # ç»Ÿè®¡
    from collections import Counter
    dist = Counter(item["style"] for item in results)
    print(f"æœ¬æ¬¡é£æ ¼åˆ†å¸ƒ: {dict(dist)}")


if __name__ == "__main__":
    main()
